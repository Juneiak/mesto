(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e){var n=e.renderer,r=e.containerSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=n,this._containerSelector=document.querySelector(r)}var n,r;return n=t,(r=[{key:"renderItems",value:function(e){var t=this;e.reverse().forEach((function(e){t._renderer(e)}))}},{key:"setItem",value:function(e){this._containerSelector.prepend(e)}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){var r=t.cardData,o=t.isAuthor,i=t.isLiked,a=t.handleCardClick,c=t.handleDeleteButtonClick,u=t.handleLikeClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._photoLink=r.link,this._placeName=r.name,this._likes=r.likes,this._cardId=r._id,this._isAuthor=o,this._isLiked=i,this._handleCardClick=a,this._handleDeleteButtonClick=c,this._handleLikeClick=u,this._templateSelector=n}var t,r;return t=e,(r=[{key:"_addCardInfo",value:function(){this._imageElement=this._photoElement.querySelector(".element__image"),this._imageElement.src=this._photoLink,this._imageElement.alt="фотография ".concat(this._placeName),this._photoElement.querySelector(".element__place-name").textContent=this._placeName}},{key:"_addDeleteButtonListener",value:function(){var e=this,t=this._photoElement.querySelector(".element__delete-button");t.classList.remove("element__delete-button_hidden");var n={card:t.closest(".element"),cardId:this._cardId};t.addEventListener("click",(function(){e._handleDeleteButtonClick(n)}))}},{key:"_addLikeListener",value:function(){var e=this,t=this._photoElement.querySelector(".element__like-amount"),n=this._photoElement.querySelector(".element__like-button");t.textContent=this._likes.length,this._isLiked&&n.classList.add("element__like-button_active"),n.addEventListener("click",(function(n){var r,o=n.target.classList;o.contains("element__like-button_active")?(o.remove("element__like-button_active"),r=!1):(o.add("element__like-button_active"),r=!0),e._handleLikeClick(r,t,e._cardId)}))}},{key:"_addListeners",value:function(){var e=this;this._addLikeListener(),this._imageElement.addEventListener("click",(function(){e._handleCardClick(e._photoLink,e._placeName)})),this._isAuthor&&this._addDeleteButtonListener()}},{key:"_getTemplate",value:function(){return document.querySelector("#template").content.querySelector(this._templateSelector).cloneNode(!0)}},{key:"getCardElement",value:function(){return this._photoElement=this._getTemplate(),this._addCardInfo(),this._addListeners(),this._photoElement}}])&&n(t.prototype,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._shimHandler=function(e){return n._handlerEcsClose(e)}}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("pop-up_opened"),document.addEventListener("keydown",this._shimHandler)}},{key:"close",value:function(){this._popup.classList.remove("pop-up_opened"),document.removeEventListener("keydown",this._shimHandler)}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){(t.target.classList.contains("pop-up_opened")||t.target.classList.contains("pop-up__close-button"))&&e.close()}))}},{key:"_handlerEcsClose",value:function(e){"Escape"===e.key&&this.close()}}])&&o(t.prototype,n),e}();function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(r);if(o){var n=f(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return s(this,e)});function a(e){var t,n=e.popupSelector,r=e.submitHandler,o=e.loadingText;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,n))._submitHandler=r,t._loadingText=o,t._formButton=t._popup.querySelector(".pop-up__form-button"),t}return t=a,(n=[{key:"renderloading",value:function(e){this._formButton.textContent=e?this._loadingText.on:this._loadingText.off}},{key:"setEventListeners",value:function(){var e=this;u(f(a.prototype),"setEventListeners",this).call(this),this._popup.querySelector(".pop-up__form").addEventListener("submit",(function(t){t.preventDefault(),e._getInputValues(),e._submitHandler(e._inputData)}))}},{key:"_getInputValues",value:function(){var e=this,t=Array.from(this._popup.querySelectorAll(".pop-up__form-text-input"));this._inputData={},t.forEach((function(t){e._inputData[t.name]=t.value}))}},{key:"close",value:function(){u(f(a.prototype),"close",this).call(this),this._popup.querySelector(".pop-up__form").reset()}}])&&c(t.prototype,n),a}(i);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t,n){return(_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(r);if(o){var n=m(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return v(this,e)});function a(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.call(this,e)}return t=a,(n=[{key:"open",value:function(e,t){var n=this._popup.querySelector(".pop-up__image"),r=this._popup.querySelector(".pop-up__caption");n.src=e,n.alt="фотография ".concat(t),r.textContent=t,_(m(a.prototype),"open",this).call(this)}}])&&d(t.prototype,n),a}(i);function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._profileName=document.querySelector(t),this._profileAbout=document.querySelector(n),this._profileAvatar=document.querySelector(r)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._profileName.textContent,about:this._profileAbout.textContent,avatar:this._profileAvatar.src}}},{key:"getUserId",value:function(){return this._userId}},{key:"setUserInfo",value:function(e){e._id&&(this._userId=e._id,this._profileName.textContent=e.name,this._profileAbout.textContent=e.about)}},{key:"setUserAvatar",value:function(e){e.avatar&&(this._profileAvatar.src=e.avatar)}}])&&k(t.prototype,n),e}();function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._settings=t,this._formElement=n}var t,n;return t=e,(n=[{key:"_showInputError",value:function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(this._settings.errorClass),t.classList.add(this._settings.inputErrorClass)}},{key:"_hideInputError",value:function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));n.textContent="",n.classList.remove(this._settings.errorClass),t.classList.remove(this._settings.inputErrorClass)}},{key:"_checkInputValidity",value:function(e,t){t.validity.valid?this._hideInputError(e,t):this._showInputError(e,t,t.validationMessage)}},{key:"_setEventListeners",value:function(e){var t=this,n=Array.from(e.querySelectorAll(this._settings.inputSelector)),r=e.querySelector(this._settings.submitButtonSelector);this._toggleButtonState(n,r),n.forEach((function(o){o.addEventListener("input",(function(){t._checkInputValidity(e,o),t._toggleButtonState(n,r)}))}))}},{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(e,t){this._hasInvalidInput(e)?(t.classList.add(this._settings.inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(this._settings.inactiveButtonClass),t.removeAttribute("disabled"))}},{key:"enableValidation",value:function(){var e=this;this.fieldSetList=Array.from(this._formElement.querySelectorAll(this._settings.fieldSetSelector)),this.fieldSetList.forEach((function(t){e._setEventListeners(t)}))}},{key:"checkValidation",value:function(){var e=this;this.fieldSetList.forEach((function(t){var n=Array.from(t.querySelectorAll(e._settings.inputSelector)),r=t.querySelector(e._settings.submitButtonSelector);n.forEach((function(o){e._hideInputError(t,o),e._toggleButtonState(n,r)}))}))}}])&&S(t.prototype,n),e}();function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._options=t}var t,n;return t=e,(n=[{key:"_checkStatus",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}},{key:"getUserProfileData",value:function(){return fetch("".concat(this._options.baseUrl,"/users/me"),{method:"GET",headers:this._options.headers}).then(this._checkStatus)}},{key:"getInitialCards",value:function(){return fetch("".concat(this._options.baseUrl,"/cards"),{method:"GET",headers:this._options.headers}).then(this._checkStatus)}},{key:"editPrifile",value:function(e){return fetch("".concat(this._options.baseUrl,"/users/me"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkStatus)}},{key:"addCard",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards"),{method:"POST",headers:this._options.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkStatus)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._options.headers}).then(this._checkStatus)}},{key:"likeStatus",value:function(e,t){var n=t?"PUT":"DELETE";return fetch("".concat(this._options.baseUrl,"/cards/likes/").concat(e),{method:n,headers:this._options.headers}).then(this._checkStatus)}},{key:"changeAvatar",value:function(e){return fetch("".concat(this._options.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({avatar:e})}).then(this._checkStatus)}}])&&w(t.prototype,n),e}();function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t,n){return(P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=q(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=q(r);if(o){var n=q(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return I(this,e)});function a(e){var t,n=e.popupSelector,r=e.clickHandler;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,n))._clickHandler=r,t._button=t._popup.querySelector("#button"),t._shimClickHandler=function(){return t._clickHandler(t._itemData)},t}return t=a,(n=[{key:"open",value:function(e){P(q(a.prototype),"open",this).call(this),this._itemData=e,this._button.addEventListener("click",this._shimClickHandler)}},{key:"close",value:function(){P(q(a.prototype),"close",this).call(this),this._button.removeEventListener("click",this._shimClickHandler)}}])&&O(t.prototype,n),a}(i),T=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),R=document.querySelector(".profile__avatar-button"),B=document.querySelector("#edit-form"),U=document.querySelector("#add-form"),D=document.querySelector("#changeAvatar"),H=document.querySelector("#name"),N=document.querySelector("#about"),V=(Array.from(document.querySelectorAll(".pop-up")),{fieldSetSelector:".pop-up__form-container",inputSelector:".pop-up__form-text-input",submitButtonSelector:".pop-up__form-button",inactiveButtonClass:"pop-up__form-button_inactive",inputErrorClass:"pop-up__form-text-input_type_error",errorClass:"pop-up__error_visible"}),J=new C({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-24",headers:{authorization:"3014e336-ab57-4b21-b9d4-747bb8ba5538","Content-Type":"application/json"}}),G=new g(".profile__name",".profile__about",".profile__avatar");J.getUserProfileData().then((function(e){G.setUserInfo(e),G.setUserAvatar(e)}));var z=function(e){var t=G.getUserId(),n=e.owner._id===t,o=e.likes.some((function(e){return e._id===t}));return new r({isLiked:o,isAuthor:n,cardData:e,handleCardClick:function(e,t){return F.open(e,t)},handleDeleteButtonClick:function(e){return Q.open(e)},handleLikeClick:function(e,t,n){J.likeStatus(n,e).then((function(e){t.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}},".element").getCardElement()},M=new t({renderer:function(e){M.setItem(z(e))},containerSelector:".elements__table"});J.getInitialCards().then((function(e){M.renderItems(e)})).catch((function(e){return console.log(e)}));var F=new b("#photo"),K=new p({popupSelector:"#changeAvatarPopup",loadingText:{off:"Сохранить",on:"Сохранение..."},submitHandler:function(e){K.renderloading(!0),J.changeAvatar(e.newAvatarUrl).then((function(e){G.setUserAvatar(e),K.close()})).catch((function(e){return console.log(e)})).finally((function(){return K.renderloading(!1)}))}}),Q=new A({popupSelector:"#delete",clickHandler:function(e){J.deleteCard(e.cardId).then((function(t){e.card.remove(),Q.close()})).catch((function(e){return console.log(e)}))}}),W=new p({popupSelector:"#add",loadingText:{off:"Создать",on:"Cоздание..."},submitHandler:function(e){W.renderloading(!0),J.addCard(e).then((function(e){M.setItem(z(e)),W.close()})).catch((function(e){return console.log(e)})).finally((function(){return W.renderloading(!1)}))}}),X=new p({popupSelector:"#edit",loadingText:{off:"Сохранить",on:"Сохранение..."},submitHandler:function(e){X.renderloading(!0),J.editPrifile(e).then((function(e){G.setUserInfo(e),X.close()})).catch((function(e){return console.log(e)})).finally((function(){return X.renderloading(!1)}))}}),Y=function(e){var t=new E(V,e);return t.enableValidation(),t},Z=Y(U),$=Y(B),ee=Y(D);F.setEventListeners(),W.setEventListeners(),X.setEventListeners(),Q.setEventListeners(),K.setEventListeners(),T.addEventListener("click",(function(){var e=G.getUserInfo();H.value=e.name,N.value=e.about,$.checkValidation(),X.open()})),x.addEventListener("click",(function(){Z.checkValidation(),W.open()})),R.addEventListener("click",(function(){ee.checkValidation(),K.open()}))})();